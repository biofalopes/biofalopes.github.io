

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Basic Dev Environment on AWS using Terraform - Hi, Iâ€™m Fabio</title>

  <meta name="description" content="Using Terraform to deploy a basic dev environment on AWS">
  <meta name="author" content="Fabio M. Lopes"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Fabio M. Lopes",
    
    "url": "https:\/\/fabiolopes.page\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fabiolopes.page\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fabiolopes.page\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fabiolopes.page\/post\/terraform-1\/",
          "name": "Basic dev environment on aws using terraform"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Fabio M. Lopes"
  },
  "headline": "Basic Dev Environment on AWS using Terraform",
  "description" : "It\u0026rsquo;s good to have a basic terraform code that deploys a basic environment on AWS whenever you need to run some quick tests on a free tier account.\nWe\u0026rsquo;ll have the following resources deployed with this procedure:\n1 VPC 1 Subnet 1 Internet Gateway 1 Route Table (with a default route and an association) 1 Security group 1 Key Pair 1 EC2 Instance It\u0026rsquo;s a very simple and you can build on top of it according to your needs, like adding a RDS instance or more EC2 instances, changing the instance type and so on. The code will be organized in the following structure:\n",
  "inLanguage" : "en",
  "wordCount":  1105 ,
  "datePublished" : "2022-07-30T00:00:00\u002b00:00",
  "dateModified" : "2022-07-30T00:00:00\u002b00:00",
  "image" : "https:\/\/fabiolopes.page\/img\/logo.jpg",
  "keywords" : [ "terraform" ],
  "mainEntityOfPage" : "https:\/\/fabiolopes.page\/post\/terraform-1\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fabiolopes.page\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/fabiolopes.page\/img\/logo.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Basic Dev Environment on AWS using Terraform" />
<meta property="og:description" content="Using Terraform to deploy a basic dev environment on AWS">
<meta property="og:image" content="https://fabiolopes.page/img/logo.jpg" />
<meta property="og:url" content="https://fabiolopes.page/post/terraform-1/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Fabio M. Lopes" />

  <meta name="twitter:title" content="Basic Dev Environment on AWS using Terraform" />
  <meta name="twitter:description" content="Using Terraform to deploy a basic dev environment on AWS">
  <meta name="twitter:image" content="https://fabiolopes.page/img/logo.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://fabiolopes.page/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.139.3">
  <link rel="alternate" href="https://fabiolopes.page/index.xml" type="application/rss+xml" title="Fabio M. Lopes"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://fabiolopes.page/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://fabiolopes.page/css/highlight.min.css" /><link rel="stylesheet" href="https://fabiolopes.page/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://fabiolopes.page/">Fabio M. Lopes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Fabio M. Lopes" href="https://fabiolopes.page/">
            <img class="avatar-img" src="https://fabiolopes.page/img/logo.jpg" alt="Fabio M. Lopes" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1
      
         
          data-img-src-1="https://fabiolopes.page/img/terraform/terraform-aws-dark.jpg"
         
         data-img-desc-1="terraform-aws-dark"
      ></div>
  

  <header class="header-section has-img">
    
      
      <div class="intro-header big-img" style="background-image: url('img/terraform/terraform-aws-dark.jpg');">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>Basic Dev Environment on AWS using Terraform</h1>
                  
                    
                      <h2 class="post-subheading">Using Terraform to deploy a basic dev environment on AWS</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on July 30, 2022
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;6&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1105&nbsp;words
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Fabio M. Lopes
      
    
  
  
</span>


                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;">terraform-aws-dark</span>
      </div>
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Basic Dev Environment on AWS using Terraform</h1>
              
              
              
                
                  <h2 class="post-subheading">Using Terraform to deploy a basic dev environment on AWS</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on July 30, 2022
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;6&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1105&nbsp;words
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Fabio M. Lopes
      
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>It&rsquo;s good to have a basic terraform code that deploys a basic environment on AWS whenever you need to run some quick tests on a free tier account.</p>
<!-- raw HTML omitted -->
<p>We&rsquo;ll have the following resources deployed with this procedure:</p>
<ul>
<li>1 VPC</li>
<li>1 Subnet</li>
<li>1 Internet Gateway</li>
<li>1 Route Table (with a default route and an association)</li>
<li>1 Security group</li>
<li>1 Key Pair</li>
<li>1 EC2 Instance</li>
</ul>
<p>It&rsquo;s a very simple and you can build on top of it according to your needs, like adding a RDS instance or more EC2 instances, changing the instance type and so on. The code will be organized in the following structure:</p>
<ul>
<li><strong>main.tf</strong>: resource declaration</li>
<li><strong>providers.tf</strong>: aws provider configuration</li>
<li><strong>outputs.tf</strong>: output declaration</li>
<li><strong>datasources.tf</strong>: we&rsquo;ll get the AMI information here</li>
<li><strong>variables.tf</strong>: only to inform our OS</li>
<li><strong>terraform.tfvars</strong>: same as previous</li>
<li><strong>userdata.tpl</strong>: script to be executed on first boot</li>
<li><strong>linux-ssh-config.tpl</strong>: SSH config for Linux</li>
<li><strong>windows-ssh-config.tpl</strong>: SSH config for Windows</li>
</ul>
<p>I added a local-exec provisioner that adds the host information in the ssh configuration, and with that we can then use it with VS Code and Remote SSH extension to connect directly to it and run our code.</p>
<p>I&rsquo;ll put the code first and then explain the most important parts. Let&rsquo;s start with <code>providers.tf</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">terraform {
</span></span><span class="line"><span class="cl">  required_providers {
</span></span><span class="line"><span class="cl">    aws = {
</span></span><span class="line"><span class="cl">      source  = &#34;hashicorp/aws&#34;
</span></span><span class="line"><span class="cl">      version = &#34;~&gt; 3.0&#34;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">provider &#34;aws&#34; {
</span></span><span class="line"><span class="cl">  shared_credentials_file = &#34;/home/mando/.aws/credentials&#34;
</span></span><span class="line"><span class="cl">  profile                 = &#34;mando&#34;
</span></span><span class="line"><span class="cl">  region                  = &#34;us-east-1&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>Terraform requires credentials to access your account on AWS. You can choose different approaches for that, like putting the keys directly instad of pointing to a credentials file. Although that works and might even be easier, you&rsquo;ll probably have your code pushed into a git repository which would then expose the keys. More information on how to configure the provider can be found here -&gt; <a href="https://registry.terraform.io/providers/hashicorp/aws/latest/">Docs overview | hashicorp/aws</a>.</p>
<p>Now for the <code>main.tf</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_vpc&#34;</span> <span class="s2">&#34;mando_vpc&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">cidr_block</span>           <span class="o">=</span> <span class="s2">&#34;10.10.0.0/16&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">enable_dns_hostnames</span> <span class="o">=</span> <span class="bp">true</span>
</span></span><span class="line"><span class="cl">  <span class="n">enable_dns_support</span>   <span class="o">=</span> <span class="bp">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;dev&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_subnet&#34;</span> <span class="s2">&#34;mando_public_subnet&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_id</span>                  <span class="o">=</span> <span class="n">aws_vpc</span><span class="o">.</span><span class="n">mando_vpc</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">cidr_block</span>              <span class="o">=</span> <span class="s2">&#34;10.10.1.0/24&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">map_public_ip_on_launch</span> <span class="o">=</span> <span class="bp">true</span>
</span></span><span class="line"><span class="cl">  <span class="n">availability_zone</span>       <span class="o">=</span> <span class="s2">&#34;us-east-1b&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;dev-public&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_internet_gateway&#34;</span> <span class="s2">&#34;mando_internet_gw&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">aws_vpc</span><span class="o">.</span><span class="n">mando_vpc</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;dev-igw&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_route_table&#34;</span> <span class="s2">&#34;mando_public_rt&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">aws_vpc</span><span class="o">.</span><span class="n">mando_vpc</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;dev-public-rt&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_route&#34;</span> <span class="s2">&#34;mando_default_route&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">route_table_id</span>         <span class="o">=</span> <span class="n">aws_route_table</span><span class="o">.</span><span class="n">mando_public_rt</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">destination_cidr_block</span> <span class="o">=</span> <span class="s2">&#34;0.0.0.0/0&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">gateway_id</span>             <span class="o">=</span> <span class="n">aws_internet_gateway</span><span class="o">.</span><span class="n">mando_internet_gw</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_main_route_table_association&#34;</span> <span class="s2">&#34;mando_public_assoc&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_id</span>         <span class="o">=</span> <span class="n">aws_vpc</span><span class="o">.</span><span class="n">mando_vpc</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">route_table_id</span> <span class="o">=</span> <span class="n">aws_route_table</span><span class="o">.</span><span class="n">mando_public_rt</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_security_group&#34;</span> <span class="s2">&#34;mando_sg&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">name</span>        <span class="o">=</span> <span class="s2">&#34;mando-sg&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">description</span> <span class="o">=</span> <span class="s2">&#34;mando Security Group&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_id</span>      <span class="o">=</span> <span class="n">aws_vpc</span><span class="o">.</span><span class="n">mando_vpc</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">ingress</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">from_port</span>   <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_port</span>     <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">protocol</span>    <span class="o">=</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;200.199.198.197/32&#34;</span><span class="p">]</span> <span class="c1"># Replace with your public IP</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">egress</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">from_port</span>   <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">to_port</span>     <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">protocol</span>    <span class="o">=</span> <span class="s2">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cidr_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;0.0.0.0/0&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;mando-sg&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_key_pair&#34;</span> <span class="s2">&#34;mando_key&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">key_name</span>   <span class="o">=</span> <span class="s2">&#34;mando-key&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">public_key</span> <span class="o">=</span> <span class="s2">&#34;ssh-rsa AAAABACH3L0Lc2EAAAADAQAPNCDAgQDELie/jIMM8uno12enId2YTmTjK1OGZJtTJFoSPdXIwn79qpZYQ3WXL8PlI/8dqFyGXvQj5bGJbgEydjSYVHFXFhPr4sdKcjguWbu895EjK2DgalcYuC1+6jBbFxiodoObsc+84m81+BACH3L0LQU3cm/rNKufrh6d21jIe4sQVul+WzJ9E8aPk34rPmRPgjYvh1T/P2hdgiUyJmKqOtDYwpokDRad+3W+iwGfoBACH3L0LoCWJ2rYzz6j80FKoiHm9cnSXvErezT7aAdenVzY3nEE4ylnHWVUdmzXN7IbCSLsDV3sdn0+c5E6oDX2/k1VwtSQ8TrUblM7AdpuB4ADniUSYvLqjd/NBIiHODzV6qZxXqoltVTsrTpbCWf1A063PBACH3L0L/F3mxBihWRAKfD1iqqfMXmYvAPosOkJ3u1yuwy/eCi6Q3SmA5n0vBSVKmYdUB9yQdAimWcUqabRzXLz+g8BrUxCBHwOf4+IZAp2AseJeoDQs0aqMwybr/k= mando&#34;</span> <span class="c1"># replace with your key</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">resource</span> <span class="s2">&#34;aws_instance&#34;</span> <span class="s2">&#34;mando_node&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">ami</span>                    <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">aws_ami</span><span class="o">.</span><span class="n">server_ami</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">instance_type</span>          <span class="o">=</span> <span class="s2">&#34;t2.micro&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="n">key_name</span>               <span class="o">=</span> <span class="n">aws_key_pair</span><span class="o">.</span><span class="n">mando_key</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">vpc_security_group_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">aws_security_group</span><span class="o">.</span><span class="n">mando_sg</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">subnet_id</span>              <span class="o">=</span> <span class="n">aws_subnet</span><span class="o">.</span><span class="n">mando_public_subnet</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">  <span class="n">user_data</span>              <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="s2">&#34;userdata.tpl&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">root_block_device</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">volume_size</span> <span class="o">=</span> <span class="mi">10</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">provisioner</span> <span class="s2">&#34;local-exec&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">command</span> <span class="o">=</span> <span class="n">templatefile</span><span class="p">(</span><span class="s2">&#34;${var.host_os}-ssh-config.tpl&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">hostname</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_ip</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">user</span>         <span class="o">=</span> <span class="s2">&#34;ubuntu&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="n">identityfile</span> <span class="o">=</span> <span class="s2">&#34;~/.ssh/id_rsa&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="n">interpreter</span> <span class="o">=</span> <span class="k">var</span><span class="o">.</span><span class="n">host_os</span> <span class="o">==</span> <span class="s2">&#34;windows&#34;</span> <span class="err">?</span> <span class="p">[</span><span class="s2">&#34;powershell&#34;</span><span class="p">,</span> <span class="s2">&#34;-Command&#34;</span><span class="p">]</span> <span class="p">:</span> <span class="p">[</span><span class="s2">&#34;bash&#34;</span><span class="p">,</span> <span class="s2">&#34;-c&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">tags</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Name</span> <span class="o">=</span> <span class="s2">&#34;mando-node&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>We&rsquo;ll not be using the default VPC or any other that was previously deployed, so we start by creating a VPC, a subnet and an Internet Gateway. We then have to create the route table, the default route and associate it with our VPC.</p>
<p>After that, we create a security group and configure it to allow TCP access from our public IP. This of course can be adjusted according to specific needs, so I used a simple example that is not restrictive regarding what can be accessed, but very restrictive in the source IP. This prevents any access from outside, but might stop you from working with more people or from different places, and you&rsquo;ll have to adjust the SG whenever your public ip changes.</p>
<p>Then we create a key pair, and here you can use an existing one or generate a specific for this case, and you can also point to a file instead of pasting the key on the code.</p>
<p>And last, but not least important, we specify an EC2 instance. The instance type is one that falls into free tier, and the <strong>root_block_device</strong> block is used to change the default size to 10. This can also be changed accordingly.</p>
<p><code>datasources.tf</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">data &#34;aws_ami&#34; &#34;server_ami&#34; {
</span></span><span class="line"><span class="cl">  most_recent = true
</span></span><span class="line"><span class="cl">  owners      = [&#34;099720109477&#34;]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  filter {
</span></span><span class="line"><span class="cl">    name   = &#34;name&#34;
</span></span><span class="line"><span class="cl">    values = [&#34;ubuntu/images/hvm-ssd/ubuntu-focal-20.04-amd64-server-*&#34;]
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>We use a data block to determine the AMI ID, since it changes between regions. We also use a filter block with a <strong>*</strong> at the end of the name, so we always pick the latest version. This can be changed when you want to lock in a specific version, which would be a best practice in production environments. Since we&rsquo;re just testing, we might use the updated image with the latest security fixes.</p>
<p><code>variables.tf</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">variable</span> <span class="s2">&#34;host_os&#34;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">type</span> <span class="o">=</span> <span class="n">string</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>terraform.tfvars</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">host_os = &#34;linux&#34;
</span></span></code></pre></div><p>A single variable is declared and are used just for informing which OS we use (Windows or Linux).</p>
<p><code>outputs.tf</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">output &#34;dev_ip&#34; {
</span></span><span class="line"><span class="cl">  value = aws_instance.mando_node.public_ip
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></div><p>The only output we have is the public IP address of the EC2 instance, which we&rsquo;ll need to access it.</p>
<p><code>userdata.tpl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">sudo apt -y update <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">sudo apt -y install <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    software-properties-common  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    curl <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    lsb-release <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo mkdir -p /etc/apt/keyrings <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="p">|</span> sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="s2">&#34;deb [arch=</span><span class="k">$(</span>dpkg --print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
</span></span></span><span class="line"><span class="cl"><span class="s2">  </span><span class="k">$(</span>lsb_release -cs<span class="k">)</span><span class="s2"> stable&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">sudo apt -y update <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">sudo apt -y install docker-ce docker-ce-cli containerd.io docker-compose-plugin <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">sudo groupadd docker <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">newgrp docker <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">sudo usermod -aG docker ubuntu
</span></span></code></pre></div><p>This userdata will install docker on the EC2 instance.</p>
<p><code>windows-ssh-config.tpl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">add-content -path c:/users/fabio/.ssh/config -value @&#39;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host ${hostname}
</span></span><span class="line"><span class="cl">    HostName ${hostname}
</span></span><span class="line"><span class="cl">    User ${user}
</span></span><span class="line"><span class="cl">    IdentityFile ${identityfile}
</span></span><span class="line"><span class="cl">&#39;@
</span></span></code></pre></div><p><code>linux-ssh-config.tpl</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cat &lt;&lt; EOF &gt;&gt; ~/.ssh/config
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host ${hostname}
</span></span><span class="line"><span class="cl">    HostName ${hostname}
</span></span><span class="line"><span class="cl">    User ${user}
</span></span><span class="line"><span class="cl">    IdentityFile ${identityfile}
</span></span><span class="line"><span class="cl">EOF
</span></span></code></pre></div><p>These two template files - <strong>windows-ssh-config.tpl</strong> and <strong>linux-ssh-config.tpl</strong> - are used by the local-exec provisioner to add the host information in our ssh configuration. This will make it easier to access it from VS Code.</p>
<p>After you apply this code, you can then proceed to configure Remote SSH on VS Code and use it as a remote dev node. I&rsquo;ll not cover here how to do this since the focus is the Terraform itself, and because it is easily done.</p>


        
          <div class="blog-tags">
            
              
              <a href="https://fabiolopes.page/tags/terraform/">terraform</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f&amp;text=Basic%20Dev%20Environment%20on%20AWS%20using%20Terraform&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f&amp;title=Basic%20Dev%20Environment%20on%20AWS%20using%20Terraform" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f&amp;title=Basic%20Dev%20Environment%20on%20AWS%20using%20Terraform" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f&amp;title=Basic%20Dev%20Environment%20on%20AWS%20using%20Terraform" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ffabiolopes.page%2fpost%2fterraform-1%2f&amp;description=Basic%20Dev%20Environment%20on%20AWS%20using%20Terraform" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/post/eks_outpost/">Deploying a Local EKS Cluster on AWS Outposts</a></li>
                
                    <li><a href="/post/terraform-study-guide/">HashiCorp Certified: Terraform Associate Exam</a></li>
                
                    <li><a href="/post/terraform-2/">Managing AWS Autoscaling Groups and Load Balancers using Terraform</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fabiolopes.page/post/jenkins-1/" data-toggle="tooltip" data-placement="top" title="Getting started with Jenkins Declarative Pipelines">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://fabiolopes.page/post/terraform-2/" data-toggle="tooltip" data-placement="top" title="Managing AWS Autoscaling Groups and Load Balancers using Terraform">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
      
      
      
      
          
          <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-default" type="button">Show <span class="disqus-comment-count" data-disqus-url="https://fabiolopes.page/post/terraform-1">comments</span></button>
            <div id="disqus_thread"></div>

            <script type="text/javascript">
              var disqus_config = function () {
              this.page.url = 'https:\/\/fabiolopes.page\/post\/terraform-1';
            };

          </script>
          </div>
          
        
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:fabioctba01@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/biofalopes" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/fabiomlopes" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://fabiolopes.page">Fabio M. Lopes</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://fabiolopes.page/">Fabio M. Lopes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.139.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://fabiolopes.page/js/main.js"></script>
<script src="https://fabiolopes.page/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://fabiolopes.page/js/load-photoswipe.js"></script>









<script type="text/javascript">
$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'fabiomlopes';
      
    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();
      
    $(this).hide(); 
    });
  });
      
</script>
<script id="dsq-count-scr" src="//fabiomlopes.disqus.com/count.js" async></script>




    
  </body>
</html>

