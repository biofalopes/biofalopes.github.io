

<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>Using Rook to leverage Ceph storage on a Kubernetes cluster - Hi, Iâ€™m Fabio</title>

  <meta name="description" content="We used Rook to leverage Ceph storage on some Kubernetes clusters with unused storage devices to provide a great option for persistent volumes.">
  <meta name="author" content="Fabio M. Lopes"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "Fabio M. Lopes",
    
    "url": "https:\/\/fabiolopes.page\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/fabiolopes.page\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/fabiolopes.page\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/fabiolopes.page\/post\/rook\/",
          "name": "Using rook to leverage ceph storage on a kubernetes cluster"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Fabio M. Lopes"
  },
  "headline": "Using Rook to leverage Ceph storage on a Kubernetes cluster",
  "description" : "I recently got 10 bare-metal servers to play with, they used to be part of our first Ceph cluster and got replaced with more powerful hardware. So i built two k8s clusters and decided to give Rook a try.\nAs the cluster grew bigger, we purchased not only more servers but with different configuration. But those Dell R530 servers still have pretty decent power to run many internal demands we have, so i built a Ceph cluster with four of them using CentOS 8, Ceph Octopus and deployed everything in containers. But i want to talk about what i did with the remaining six servers, that became two kubernetes clusters - one with Flatcar and the other with Centos, to replicate some production scenarios we have. Since the servers have 8 2TB HDD each and we use just one for the OS, that would be a perfect scenario to experiment with Rook. I tinkered with it previously with some labs but now i could really test its usability.\n",
  "inLanguage" : "en",
  "wordCount":  1150 ,
  "datePublished" : "2021-07-17T00:00:00\u002b00:00",
  "dateModified" : "2021-07-17T00:00:00\u002b00:00",
  "image" : "https:\/\/fabiolopes.page\/img\/logo.jpg",
  "keywords" : [ "ceph, kubernetes" ],
  "mainEntityOfPage" : "https:\/\/fabiolopes.page\/post\/rook\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/fabiolopes.page\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/fabiolopes.page\/img\/logo.jpg",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="Using Rook to leverage Ceph storage on a Kubernetes cluster" />
<meta property="og:description" content="We used Rook to leverage Ceph storage on some Kubernetes clusters with unused storage devices to provide a great option for persistent volumes.">
<meta property="og:image" content="https://fabiolopes.page/img/logo.jpg" />
<meta property="og:url" content="https://fabiolopes.page/post/rook/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="Fabio M. Lopes" />

  <meta name="twitter:title" content="Using Rook to leverage Ceph storage on a Kubernetes cluster" />
  <meta name="twitter:description" content="We used Rook to leverage Ceph storage on some Kubernetes clusters with unused storage devices to provide a great option for persistent volumes.">
  <meta name="twitter:image" content="https://fabiolopes.page/img/logo.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <link href='https://fabiolopes.page/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta name="generator" content="Hugo 0.139.3">
  <link rel="alternate" href="https://fabiolopes.page/index.xml" type="application/rss+xml" title="Fabio M. Lopes"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css" integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.6.0/css/all.css" integrity="sha384-h/hnnw1Bi4nbpD6kE7nYfCXzovi622sY5WBxww8ARKwpdLj5kUWjRuyiXaD1U2JT" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous"><link rel="stylesheet" href="https://fabiolopes.page/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://fabiolopes.page/css/highlight.min.css" /><link rel="stylesheet" href="https://fabiolopes.page/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://fabiolopes.page/">Fabio M. Lopes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="Fabio M. Lopes" href="https://fabiolopes.page/">
            <img class="avatar-img" src="https://fabiolopes.page/img/logo.jpg" alt="Fabio M. Lopes" />
           
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  
    <div id="header-big-imgs" data-num-img=1
      
         
          data-img-src-1="https://fabiolopes.page/img/ceph/rook_banner.png"
         
         data-img-desc-1="rook"
      ></div>
  

  <header class="header-section has-img">
    
      
      <div class="intro-header big-img" style="background-image: url('img/ceph/rook_banner.png');">
        
        <div class="container">
          <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <div class="post-heading">
                <h1>Using Rook to leverage Ceph storage on a Kubernetes cluster</h1>
                  
                    
                      <h2 class="post-subheading">We used Rook to leverage Ceph storage on some Kubernetes clusters with unused storage devices to provide a great option for persistent volumes.</h2>
                    
                  
                  
                    <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on July 17, 2021
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;6&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1150&nbsp;words
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Fabio M. Lopes
      
    
  
  
</span>


                  
              </div>
            </div>
          </div>
        </div>
        <span class="img-desc" style="display: inline;">rook</span>
      </div>
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>Using Rook to leverage Ceph storage on a Kubernetes cluster</h1>
              
              
              
                
                  <h2 class="post-subheading">We used Rook to leverage Ceph storage on some Kubernetes clusters with unused storage devices to provide a great option for persistent volumes.</h2>
                
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on July 17, 2021
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;6&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1150&nbsp;words
  
  
    
      
        &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Fabio M. Lopes
      
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>I recently got 10 bare-metal servers to play with, they used to be part of our first Ceph cluster and got replaced with more powerful hardware. So i built two k8s clusters and decided to give Rook a try.</p>
<!-- raw HTML omitted -->
<p>As the cluster grew bigger, we purchased not only more servers but with different configuration. But those Dell R530 servers still have pretty decent power to run many internal demands we have, so i built a Ceph cluster with four of them using CentOS 8, Ceph Octopus and deployed everything in containers. But i want to talk about what i did with the remaining six servers, that became two kubernetes clusters - one with Flatcar and the other with Centos, to replicate some production scenarios we have. Since the servers have 8 2TB HDD each and we use just one for the OS, that would be a perfect scenario to experiment with Rook. I tinkered with it previously with some labs but now i could really test its usability.</p>
<p>Getting Rook to run is pretty straightforward, it might not even be necessary to have great knowledge about ceph for the initial setup. However it would be mandatory to know about Ceph administration for a production environment. There are many administrative tasks that gets taken care of by Rook, but after working with Ceph for the past 3 years i can assure you that there will be many situations where the sysadmin will have to step up.</p>
<p>I used the quickstart guide as a reference, it can be found on the Rook GitHub page: <a href="https://rook.github.io/docs/rook/v1.6/ceph-quickstart.html">https://rook.github.io/docs/rook/v1.6/ceph-quickstart.html</a>.</p>
<p>The only parameter i changed from the defaults was the ROOK_ENABLE_DISCOVERY_DAEMON, since i wanted it to automatically detect and provision the OSDs on every empty device. It&rsquo;s important to erase the disks prior to the deployment, because it will skip any device with partitions. For that you can use <code>wipefs</code> or even <code>dd</code>. Be aware that if the device has LVM partitions and you want to avoid a reboot you might want to delete the LVs and VGs first. If you wipe the device the kernel might not release the mapped lvm volumes and you will not be able to delete after that. Needless to say that i made that mistake a few times before learning the lesson.</p>
<p>Commands i used:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git clone --single-branch --branch master https://github.com/rook/rook.git
</span></span><span class="line"><span class="cl">git checkout release-1.6
</span></span><span class="line"><span class="cl">cd rook/cluster/examples/kubernetes/ceph
</span></span><span class="line"><span class="cl">sed -i s/&#34;ROOK_ENABLE_DISCOVERY_DAEMON: \&#34;false\&#34;&#34;/&#34;ROOK_ENABLE_DISCOVERY_DAEMON: \&#34;true\&#34;&#34;/ operator.yaml
</span></span><span class="line"><span class="cl">kubectl create -f crds.yaml -f common.yaml -f operator.yaml
</span></span><span class="line"><span class="cl">kubectl create -f cluster.yaml
</span></span></code></pre></div><p>Checking if the pods were created:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">rook</span><span class="o">-</span><span class="n">ceph</span> <span class="n">get</span> <span class="n">pod</span>
</span></span><span class="line"><span class="cl"><span class="n">NAME</span>                                              <span class="n">READY</span>   <span class="n">STATUS</span>      <span class="n">RESTARTS</span>   <span class="n">AGE</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">cephfsplugin</span><span class="o">-</span><span class="mi">7</span><span class="n">tkgk</span>                            <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">25</span>         <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">cephfsplugin</span><span class="o">-</span><span class="n">cv2kq</span>                            <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">6</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">cephfsplugin</span><span class="o">-</span><span class="n">provisioner</span><span class="o">-</span><span class="n">bc5cff84</span><span class="o">-</span><span class="mi">8</span><span class="n">h5b4</span>       <span class="mi">6</span><span class="o">/</span><span class="mi">6</span>     <span class="n">Running</span>     <span class="mi">19</span>         <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">cephfsplugin</span><span class="o">-</span><span class="n">provisioner</span><span class="o">-</span><span class="n">bc5cff84</span><span class="o">-</span><span class="n">cb477</span>       <span class="mi">6</span><span class="o">/</span><span class="mi">6</span>     <span class="n">Running</span>     <span class="mi">6</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">cephfsplugin</span><span class="o">-</span><span class="n">qvqjc</span>                            <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">3</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">rbdplugin</span><span class="o">-</span><span class="mi">2</span><span class="n">rqwk</span>                               <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">25</span>         <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">rbdplugin</span><span class="o">-</span><span class="n">g5tkj</span>                               <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">3</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">rbdplugin</span><span class="o">-</span><span class="n">provisioner</span><span class="o">-</span><span class="mi">97957587</span><span class="n">f</span><span class="o">-</span><span class="n">gvn6r</span>         <span class="mi">6</span><span class="o">/</span><span class="mi">6</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">rbdplugin</span><span class="o">-</span><span class="n">provisioner</span><span class="o">-</span><span class="mi">97957587</span><span class="n">f</span><span class="o">-</span><span class="n">lflc7</span>         <span class="mi">6</span><span class="o">/</span><span class="mi">6</span>     <span class="n">Running</span>     <span class="mi">8</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">csi</span><span class="o">-</span><span class="n">rbdplugin</span><span class="o">-</span><span class="n">vcsdj</span>                               <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="n">Running</span>     <span class="mi">6</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">crashcollector</span><span class="o">-</span><span class="n">node1</span><span class="o">-</span><span class="mi">7</span><span class="n">fcbcd7dc6</span><span class="o">-</span><span class="mi">6</span><span class="n">fbq6</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">73</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">crashcollector</span><span class="o">-</span><span class="n">node2</span><span class="o">-</span><span class="mi">7</span><span class="n">f699c88c</span><span class="o">-</span><span class="mi">78</span><span class="n">gvw</span>    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">crashcollector</span><span class="o">-</span><span class="n">node3</span><span class="o">-</span><span class="mi">77777995</span><span class="n">d8</span><span class="o">-</span><span class="n">dtsrh</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">mgr</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="mi">8486</span><span class="n">cbdf64</span><span class="o">-</span><span class="n">dsdn2</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">24</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="mi">7758</span><span class="n">d4d54c</span><span class="o">-</span><span class="n">crq4s</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">d</span><span class="o">-</span><span class="mi">77</span><span class="n">db79f9b9</span><span class="o">-</span><span class="n">fcd5r</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">41</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">mon</span><span class="o">-</span><span class="n">e</span><span class="o">-</span><span class="mi">7</span><span class="n">d44dcff6b</span><span class="o">-</span><span class="n">zjpfl</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">operator</span><span class="o">-</span><span class="mi">66</span><span class="n">f7668857</span><span class="o">-</span><span class="n">sr8bw</span>               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">0</span><span class="o">-</span><span class="mi">57</span><span class="n">b7d8b47b</span><span class="o">-</span><span class="n">k5ps8</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">548</span><span class="n">c7bc54d</span><span class="o">-</span><span class="n">zsp8r</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">7875</span><span class="n">d885d8</span><span class="o">-</span><span class="n">h2wdt</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">5585</span><span class="n">fb7856</span><span class="o">-</span><span class="n">gxjfx</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="n">fd5bcb8f8</span><span class="o">-</span><span class="n">z9v4c</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">13</span><span class="o">-</span><span class="mi">784</span><span class="n">c797d46</span><span class="o">-</span><span class="n">qmxj4</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="mi">6</span><span class="n">b689bfb4</span><span class="o">-</span><span class="n">sfffq</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">15</span><span class="o">-</span><span class="mi">64984</span><span class="n">bf7db</span><span class="o">-</span><span class="n">h99q2</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">16</span><span class="o">-</span><span class="mi">6</span><span class="n">f66f68868</span><span class="o">-</span><span class="n">ft8d8</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="mi">66</span><span class="n">fcdfc8c8</span><span class="o">-</span><span class="n">rg76t</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">18</span><span class="o">-</span><span class="mi">85</span><span class="n">f9d5567b</span><span class="o">-</span><span class="mi">6j</span><span class="n">jph</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">19</span><span class="o">-</span><span class="mi">969</span><span class="n">b58fb</span><span class="o">-</span><span class="n">ztzxx</span>                   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">ffc69957b</span><span class="o">-</span><span class="mi">846</span><span class="n">mj</span>                   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">20</span><span class="o">-</span><span class="mi">5</span><span class="n">c86c5d556</span><span class="o">-</span><span class="mi">26</span><span class="n">kkp</span>                 <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">79</span><span class="n">cb4b8f78</span><span class="o">-</span><span class="n">wxczm</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="mi">9587</span><span class="n">d6994</span><span class="o">-</span><span class="n">z94l2</span>                   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">74</span><span class="n">cb556886</span><span class="o">-</span><span class="n">sqp6g</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">6</span><span class="o">-</span><span class="mi">5</span><span class="n">fb96bcb</span><span class="o">-</span><span class="mi">2</span><span class="n">lgqr</span>                    <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">7</span><span class="o">-</span><span class="mi">85</span><span class="n">f8659c9d</span><span class="o">-</span><span class="mi">7</span><span class="n">z5tn</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">22</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="mi">6765676</span><span class="n">bfb</span><span class="o">-</span><span class="n">kjxr5</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="mi">9</span><span class="o">-</span><span class="mi">67</span><span class="n">b4f98cdb</span><span class="o">-</span><span class="n">h9bd8</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="n">prepare</span><span class="o">-</span><span class="n">node1</span><span class="o">-</span><span class="mi">6</span><span class="n">x7dr</span>                 <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Completed</span>   <span class="mi">0</span>          <span class="mi">133</span><span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="n">prepare</span><span class="o">-</span><span class="n">node2</span><span class="o">-</span><span class="n">z6jl8</span>                 <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Completed</span>   <span class="mi">0</span>          <span class="mi">133</span><span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">osd</span><span class="o">-</span><span class="n">prepare</span><span class="o">-</span><span class="n">node3</span><span class="o">-</span><span class="n">rvhth</span>                 <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Completed</span>   <span class="mi">0</span>          <span class="mi">133</span><span class="n">m</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="mi">6</span><span class="n">f58686b5d</span><span class="o">-</span><span class="n">znnsg</span>                  <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">0</span>          <span class="mi">24</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">discover</span><span class="o">-</span><span class="mi">2684</span><span class="n">s</span>                               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">7</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">discover</span><span class="o">-</span><span class="mi">2</span><span class="n">nlkj</span>                               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">1</span>          <span class="mi">95</span><span class="n">d</span>
</span></span><span class="line"><span class="cl"><span class="n">rook</span><span class="o">-</span><span class="n">discover</span><span class="o">-</span><span class="mi">4</span><span class="n">rhxm</span>                               <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>     <span class="mi">2</span>          <span class="mi">95</span><span class="n">d</span>
</span></span></code></pre></div><p>The output is long but i wanted to show that Rook actually created a OSD por for every device in each node, and i configured kubernetes to allow that on the master node either.</p>
<p>We can see that we now have a bunch of new resource definitions, enabling us to interact with Ceph in a declarative way, instead of recurring to the CLI to manage users, filesystems, pools and many other resources:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get crd | grep &#39;rook\|objectbucket&#39;
</span></span><span class="line"><span class="cl">cephblockpools.ceph.rook.io                           2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">cephclients.ceph.rook.io                              2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">cephclusters.ceph.rook.io                             2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">cephfilesystems.ceph.rook.io                          2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">cephnfses.ceph.rook.io                                2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">cephobjectrealms.ceph.rook.io                         2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">cephobjectstores.ceph.rook.io                         2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">cephobjectstoreusers.ceph.rook.io                     2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">cephobjectzonegroups.ceph.rook.io                     2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">cephobjectzones.ceph.rook.io                          2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">cephrbdmirrors.ceph.rook.io                           2021-04-01T19:30:53Z
</span></span><span class="line"><span class="cl">objectbucketclaims.objectbucket.io                    2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">objectbuckets.objectbucket.io                         2021-04-01T19:30:54Z
</span></span><span class="line"><span class="cl">volumes.rook.io                                       2021-04-01T19:30:54Z
</span></span></code></pre></div><p>From that point we can access the Ceph CLI by interacting with the <code>rook-ceph-tools</code> pod:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">$</span> <span class="n">kubectl</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">-</span><span class="n">n</span> <span class="n">rook</span><span class="o">-</span><span class="n">ceph</span> <span class="n">rook</span><span class="o">-</span><span class="n">ceph</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="mi">6</span><span class="n">f58686b5d</span><span class="o">-</span><span class="n">znnsg</span> <span class="o">--</span> <span class="n">ceph</span> <span class="n">status</span>
</span></span><span class="line"><span class="cl"><span class="n">cluster</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">id</span><span class="p">:</span>     <span class="mf">72e9</span><span class="n">c4a9</span><span class="o">-</span><span class="mi">4315</span><span class="o">-</span><span class="mf">45e0</span><span class="o">-</span><span class="n">ad43</span><span class="o">-</span><span class="n">cd79d22fb2be</span>
</span></span><span class="line"><span class="cl">  <span class="n">health</span><span class="p">:</span> <span class="n">HEALTH_OK</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">services</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">mon</span><span class="p">:</span> <span class="mi">3</span> <span class="n">daemons</span><span class="p">,</span> <span class="n">quorum</span> <span class="n">a</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span> <span class="p">(</span><span class="n">age</span> <span class="mi">7</span><span class="n">d</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">mgr</span><span class="p">:</span> <span class="n">a</span><span class="p">(</span><span class="n">active</span><span class="p">,</span> <span class="n">since</span> <span class="mi">3</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">osd</span><span class="p">:</span> <span class="mi">21</span> <span class="n">osds</span><span class="p">:</span> <span class="mi">21</span> <span class="n">up</span> <span class="p">(</span><span class="n">since</span> <span class="mi">3</span><span class="n">w</span><span class="p">),</span> <span class="mi">21</span> <span class="ow">in</span> <span class="p">(</span><span class="n">since</span> <span class="mi">3</span><span class="n">w</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="n">rgw</span><span class="p">:</span> <span class="mi">1</span> <span class="n">daemon</span> <span class="n">active</span> <span class="p">(</span><span class="n">my</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">task</span> <span class="n">status</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">pools</span><span class="p">:</span>   <span class="mi">30</span> <span class="n">pools</span><span class="p">,</span> <span class="mi">401</span> <span class="n">pgs</span>
</span></span><span class="line"><span class="cl">  <span class="n">objects</span><span class="p">:</span> <span class="mf">2.12</span><span class="n">k</span> <span class="n">objects</span><span class="p">,</span> <span class="mf">2.4</span> <span class="n">GiB</span>
</span></span><span class="line"><span class="cl">  <span class="n">usage</span><span class="p">:</span>   <span class="mi">29</span> <span class="n">GiB</span> <span class="n">used</span><span class="p">,</span> <span class="mi">38</span> <span class="n">TiB</span> <span class="o">/</span> <span class="mi">38</span> <span class="n">TiB</span> <span class="n">avail</span>
</span></span><span class="line"><span class="cl">  <span class="n">pgs</span><span class="p">:</span>     <span class="mi">401</span> <span class="n">active</span><span class="o">+</span><span class="n">clean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">io</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="n">client</span><span class="p">:</span>   <span class="mf">7.0</span> <span class="n">KiB</span><span class="o">/</span><span class="n">s</span> <span class="n">rd</span><span class="p">,</span> <span class="mi">72</span> <span class="n">KiB</span><span class="o">/</span><span class="n">s</span> <span class="n">wr</span><span class="p">,</span> <span class="mi">6</span> <span class="n">op</span><span class="o">/</span><span class="n">s</span> <span class="n">rd</span><span class="p">,</span> <span class="mi">16</span> <span class="n">op</span><span class="o">/</span><span class="n">s</span> <span class="n">wr</span>
</span></span></code></pre></div><p>Now we have two new StorageClasses to work with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get storageclasses
</span></span><span class="line"><span class="cl">NAME               PROVISIONER                     RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
</span></span><span class="line"><span class="cl">rook-ceph-block    rook-ceph.rbd.csi.ceph.com      Delete          Immediate           false                  64d
</span></span><span class="line"><span class="cl">rook-ceph-bucket   rook-ceph.ceph.rook.io/bucket   Delete          Immediate           false                  84d
</span></span></code></pre></div><p>And then we provisioned some volumes to a few applications running on the cluster:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get pv -A
</span></span><span class="line"><span class="cl">NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                     STORAGECLASS      REASON   AGE
</span></span><span class="line"><span class="cl">pvc-1c9151ae-3e9e-49ae-adbf-f365de4eb718   8Gi        RWO            Delete           Bound    cluster-spd/data-etcd-1                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-39c5a513-1c50-48a9-9e4d-354ff84ea8b4   8Gi        RWO            Delete           Bound    cluster-spb/data-etcd-0                   rook-ceph-block            24d
</span></span><span class="line"><span class="cl">pvc-53f2816a-e4c2-434d-8600-20206d3f6f75   8Gi        RWO            Delete           Bound    cluster-spc/data-etcd-0                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-553c1a1b-0131-44a9-8a67-293dea40c161   5Gi        RWO            Delete           Bound    gitlab/redis-data-gitlab-redis-master-0   rook-ceph-block            56d
</span></span><span class="line"><span class="cl">pvc-6c38a9b7-8e23-4478-a431-34fd4f9ec158   8Gi        RWO            Delete           Bound    cluster-spd/data-etcd-2                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-76bfab8e-6ae6-4b11-8223-ea9e97bbccf4   8Gi        RWO            Delete           Bound    cluster-spc/data-etcd-2                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-836c1ff1-c92d-467c-b45b-b970824e2b04   8Gi        RWO            Delete           Bound    cluster-spc/data-etcd-1                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-87e7bd8e-250e-4bd4-8268-3fb49597d0ab   10Gi       RWO            Delete           Bound    gitlab/gitlab-minio                       rook-ceph-block            39d
</span></span><span class="line"><span class="cl">pvc-bac3dc77-73ae-4800-821a-04faa15e627d   8Gi        RWO            Delete           Bound    cluster-spb/data-etcd-1                   rook-ceph-block            24d
</span></span><span class="line"><span class="cl">pvc-ca087b82-038b-418a-a187-8e28617fbfae   8Gi        RWO            Delete           Bound    cluster-spd/data-etcd-0                   rook-ceph-block            18d
</span></span><span class="line"><span class="cl">pvc-d255ca76-b62f-413b-82b8-184ff3cb0026   8Gi        RWO            Delete           Bound    cluster-spb/data-etcd-2                   rook-ceph-block            24d
</span></span><span class="line"><span class="cl">pvc-d331d766-72d7-46c4-9cba-c0e8fea7a2b8   50Gi       RWO            Delete           Bound    gitlab/repo-data-gitlab-gitaly-0          rook-ceph-block            56d
</span></span><span class="line"><span class="cl">pvc-e76d375b-03b5-4bc0-8725-bc406cb7ee94   8Gi        RWO            Delete           Bound    gitlab/data-gitlab-postgresql-0           rook-ceph-block            56d
</span></span></code></pre></div><p>This is how the pvc manifest looks like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ kubectl get pvc -n gitlab gitlab-minio -o yaml
</span></span><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: PersistentVolumeClaim
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: gitlab-minio
</span></span><span class="line"><span class="cl">  namespace: gitlab
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    app: minio
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  storageClassName: rook-ceph-block
</span></span><span class="line"><span class="cl">  accessModes:
</span></span><span class="line"><span class="cl">  - ReadWriteOnce
</span></span><span class="line"><span class="cl">  resources:
</span></span><span class="line"><span class="cl">    requests:
</span></span><span class="line"><span class="cl">      storage: 10Gi
</span></span></code></pre></div><p>We can also provision Buckets using S3 via Rook. We used this to provide a backend for a Hashicorp Vault we have on the same environment:</p>
<p>First we have to create the StorageClass:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: storage.k8s.io/v1
</span></span><span class="line"><span class="cl">kind: StorageClass
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">   name: rook-ceph-bucket
</span></span><span class="line"><span class="cl">provisioner: rook-ceph.ceph.rook.io/bucket
</span></span><span class="line"><span class="cl">reclaimPolicy: Delete
</span></span><span class="line"><span class="cl">parameters:
</span></span><span class="line"><span class="cl">  objectStoreName: my-store
</span></span><span class="line"><span class="cl">  objectStoreNamespace: rook-ceph
</span></span><span class="line"><span class="cl">  region: us-east-1
</span></span></code></pre></div><p>Then we create a ObjectBucketClaim, which is a new resource type defined by the Rook CRD:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">apiVersion: objectbucket.io/v1alpha1
</span></span><span class="line"><span class="cl">kind: ObjectBucketClaim
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: ceph-bucket
</span></span><span class="line"><span class="cl">  namespace: vault
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  generateBucketName: ceph-bucket
</span></span><span class="line"><span class="cl">  storageClassName: rook-ceph-bucket
</span></span></code></pre></div>

        
          <div class="blog-tags">
            
              
              <a href="https://fabiolopes.page/tags/ceph/">ceph</a>&nbsp;
            
              
              <a href="https://fabiolopes.page/tags/kubernetes/">kubernetes</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f&amp;text=Using%20Rook%20to%20leverage%20Ceph%20storage%20on%20a%20Kubernetes%20cluster&amp;via=" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f&amp;title=Using%20Rook%20to%20leverage%20Ceph%20storage%20on%20a%20Kubernetes%20cluster" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f&amp;title=Using%20Rook%20to%20leverage%20Ceph%20storage%20on%20a%20Kubernetes%20cluster" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f&amp;title=Using%20Rook%20to%20leverage%20Ceph%20storage%20on%20a%20Kubernetes%20cluster" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2ffabiolopes.page%2fpost%2frook%2f&amp;description=Using%20Rook%20to%20leverage%20Ceph%20storage%20on%20a%20Kubernetes%20cluster" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  

              </div>
            </section>
        

        
          
            
          

          
                  <h4 class="see-also">See also</h4>
                  <ul>
                
                
                    <li><a href="/post/eks_outpost/">Deploying a Local EKS Cluster on AWS Outposts</a></li>
                
                    <li><a href="/post/python-s3-monitoring/">Using Python and Docker to monitor Ceph S3 from outside</a></li>
                
                    <li><a href="/post/ceph-features/">Ceph features and its relation to the client kernel version</a></li>
                
                    <li><a href="/post/ceph-features-2/">Obtaining a list of Ceph features from the hexadecimal value</a></li>
                
              </ul>

          
        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://fabiolopes.page/post/python-web-scrapper-fii/" data-toggle="tooltip" data-placement="top" title="Web scrapper using Python">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://fabiolopes.page/post/python-s3-monitoring/" data-toggle="tooltip" data-placement="top" title="Using Python and Docker to monitor Ceph S3 from outside">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
      
      
      
      
          
          <div class="disqus-comments">                  
            <button id="show-comments" class="btn btn-default" type="button">Show <span class="disqus-comment-count" data-disqus-url="https://fabiolopes.page/post/rook">comments</span></button>
            <div id="disqus_thread"></div>

            <script type="text/javascript">
              var disqus_config = function () {
              this.page.url = 'https:\/\/fabiolopes.page\/post\/rook';
            };

          </script>
          </div>
          
        
        
      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
		
		  <a href="mailto:fabioctba01@gmail.com" title="Email me">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://github.com/biofalopes" title="GitHub">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
		
		  <a href="https://linkedin.com/in/fabiomlopes" title="LinkedIn">
		
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://fabiolopes.page">Fabio M. Lopes</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://fabiolopes.page/">Fabio M. Lopes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="https://gohugo.io">Hugo v0.139.3</a> powered &nbsp;&bull;&nbsp; Theme <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> adapted from <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://fabiolopes.page/js/main.js"></script>
<script src="https://fabiolopes.page/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://fabiolopes.page/js/load-photoswipe.js"></script>









<script type="text/javascript">
$(function(){
  $('#show-comments').on('click', function(){
    var disqus_shortname = 'fabiomlopes';
      
    (function() {
      var disqus = document.createElement('script'); 
      disqus.type = 'text/javascript'; 
      disqus.async = true;
      disqus.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(disqus);
    })();
      
    $(this).hide(); 
    });
  });
      
</script>
<script id="dsq-count-scr" src="//fabiomlopes.disqus.com/count.js" async></script>




    
  </body>
</html>

